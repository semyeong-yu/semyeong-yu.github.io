---
layout: distill
title: SuGaR
date: 2024-09-05 11:00:00
description: Surface-Aligned Gaussian Splatting for Efficient 3D Mesh Reconstruction and High-Quality Mesh Rendering (CVPR 2024)
tags: gaussian splatting rendering surface
categories: 3d-view-synthesis
thumbnail: assets/img/2024-09-06-SuGaR/1.png
giscus_comments: false
disqus_comments: true
related_posts: true
# toc:
#   beginning: true
#   sidebar: right
# featured: true
_styles: >
  .fake-img {
    background: #bbb;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 0px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 12px;
  }
  .fake-img p {
    font-family: monospace;
    color: white;
    text-align: left;
    margin: 12px 0;
    text-align: center;
    font-size: 16px;
  }
---

## SuGaR: Surface-Aligned Gaussian Splatting for Efficient 3D Mesh Reconstruction and High-Quality Mesh Rendering

#### Antoine Guédon, Vincent Lepetit

> paper :  
[https://arxiv.org/abs/2311.12775](https://arxiv.org/abs/2311.12775)  
project website :  
[https://anttwo.github.io/sugar/](https://anttwo.github.io/sugar/)  
code :  
[https://github.com/Anttwo/SuGaR](https://github.com/Anttwo/SuGaR)  
reference :  
NeRF and 3DGS Study

## Surface-Aligned 3DGS

### Regularization

- 문제 :  
3DGS는 `unstructured`  
$$\rightarrow$$ `surface` 나타내지 않음

- 해결 :  
`regularization` term  
$$\rightarrow$$ 3DGS가 well-distributed and aligned with surface (flat)  
  - well-distributed :  
    - Gaussians끼리 `overlap 적음`  
    - (surface에 가까운) point $$p$$ 와 `가장 가까운 Gaussian` $$g^{\ast}$$ 가 다른 Gaussians보다 $$p$$ 의 `density에 훨씬 많이 기여`  
    $$g^{\ast} = \text{argmin}_{g}(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g})$$  

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/2024-09-05-SuGaR/1.png" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
</div>

- surface 근처의 점 sampling :  
  - assumption :  
  거의 surface 위에 있다고 볼 수 있을 정도로 가까운  
  `surface 근처`의 $$p$$ 를 `Gaussian들의 곱 분포로 sampling`  
  $$p \sim \prod_{g} N(\cdot; \mu_{g}, \Sigma{g})$$

- `density function` :  
  - $$d(p) = \sum_{g} \alpha_{g} \text{exp}(-\frac{1}{2}(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g}))$$  
  where $$\text{exp}(-\frac{1}{2}(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g}))$$ : posterior  
  where $$(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g})$$ : `Mahalanobis distance`  
  $$p$$ 가 Gaussian distribution 평균 $$\mu_{g}$$ 에서 "상대적으로" 얼마나 떨어져 있는지  
  $$p$$ 가 평균으로부터 같은 거리만큼 떨어져있더라도 convariance가 작은 방향에 있을수록 Mahalanobis distance가 커짐
  - approx. ideal density function $$\bar d(p) \in [0, 1]$$ :  
    - well-distributed Gaussians by regularization term 이므로  
    overlap 없다는 전제 하에 `하나`의 Gaussian $$g^{\ast}$$ 가 point $$p$$ 의 density 결정
    - Gaussians가 진짜 surface를 묘사하려면 `semi-transparent하지 않아야` 좋음  
    $$\rightarrow$$ $$a_{g} = 1$$ for any Gaussians
    - $$(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g}) \approx \frac{1}{s_{g}^2} \langle p-\mu_{g}, n_g \rangle^{2}$$ 이므로  
    (수식 유도는 아래에)  
    근사해서 구한 ideal density function은  
    $$\bar d(p) = \text{exp}(-\frac{1}{2s_{g^{\ast}}^2} \langle p-\mu_{g^{\ast}}, n_{g^{\ast}} \rangle^{2})$$  
    where $$g^{\ast} = \text{argmin}_{g}(p - \mu_{g})^T \Sigma_{g}^{-1}(p - \mu_{g})$$   

<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/2024-09-05-SuGaR/2.png" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
</div>
<div class="row mt-3">
    <div class="col-sm mt-3 mt-md-0">
        {% include figure.liquid loading="eager" path="assets/img/2024-09-05-SuGaR/3.png" class="img-fluid rounded z-depth-1" zoomable=true %}
    </div>
</div>

- `regularization on SDF` :  
  - $$R = | d(p) - \bar d(p) |$$  
    - $$d$$ : density function
    - $$\bar d$$ : ideal density function where 하나의 불투명한 Gaussian이 point density 결정  
  - 근데 density function $$d$$ 로 regularize하면 아래의 문제가 있다  
    - $$d$$ 는 exponential term으로 이루어져 있으므로 scale이 너무 커서 optimization에 별로다  
    - flat Gaussian으로 surface를 나타내는 게 목적인데,  
    Gaussian이 완전히 flat 하면 $$s_{g} = 0$$ 이 되어 $$\bar d(p) \rightarrow 0$$ 이므로  
    모든 level sets가 $$\mu_{g}$$ 를 지나고 normal $$n_{g}$$ 를 가지는 2D 상의 plane이 되어  
    level sets 고려하는 게 무의미해진다  
    따라서 surface를 나타내기 위해 flat하게 Gaussian을 만드는 게 목적이지만  
    그렇다고 완전히 flat하면 안 됨
  - density function 말고 `SDF` [Link](https://semyeong-yu.github.io/blog/2024/SDF/) 로 loss 만들면  
  optimization 더 잘 됨 (Gaussians가 surface에 더 잘 align됨)  
  $$R = \frac{1}{| P |} \sum_{p \in P} | \hat f(p) - f(p) |$$  
    - $$f(p) = \langle p-\mu_{g^{\ast}}, n_{g^{\ast}} \rangle = \pm s_{g^{\ast}} \sqrt{-2log(\bar d(p))} \in [0, \infty]$$ :  
    ideal distance (SDF) b.w. point $$p$$ and true surface  
    ($$\bar d(p) = 1$$ 이면, 즉 SDF $$f(p) = 0$$ 이면, true surface를 나타냄)
    - $$\hat f(p)$$ :  
    estimated distance b.w. point $$p$$ and depth map at projection of $$p$$  
    (Radix Sort로 Gaussian rasterize할 때 사용한 Gaussian depth 값들을 rendering하여 depth map을 만듦)
  
- `regularization on normal` vector :  
  - normal vector의 방향 $$n_{g}$$ 을 SDF gradient 방향으로 맞춰주기 위해  
  (normal vector 방향을 잘 잡아줘야 surface에 잘 align됨)  
  $$R_{Norm} = \frac{1}{| P |} \sum_{p \in P} \| \frac{\nabla f(p)}{\| \nabla f(p) \|} - n_{g^{\ast}} \|^2$$

### Approximation of Density function

- Eigendecomposition을 하면 $$\Sigma_{g} = Q \Lambda Q^T$$ `????`

where $$s_g$$ : convariance가 가장 작은 방향의 vector  
where $$n_g = \frac{s_g}{\| s_g \|}$$

## Issue 2

### TBD

- 문제 :  
`Densification`을 거치면 3DGS 수가 너무 `많아`지고 너무 `작아`져서  
texture나 detail을 나타내기 힘듦  
$$\rightarrow$$ 거의 모든 곳에서 density function $$d = 0$$ 이고,  
위에서 언급했듯이 level sets 고려하는 게 의미가 없어져서  
Marching Cubes 기법으로 이러한 `sparse density function`의 `level sets`를 추출하기 어렵

- 해결 :  
42:20 TBD

## Issue 3