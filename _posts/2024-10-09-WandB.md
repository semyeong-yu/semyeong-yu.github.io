---
layout: distill
title: WandB
date: 2024-10-09 12:00:00
description: WandB Tutorial
tags: wandb log sweep
categories: others
giscus_comments: false
disqus_comments: true
related_posts: true

_styles: >
  .fake-img {
    background: #bbb;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 0px 4px rgba(0, 0, 0, 0.1);
    margin-bottom: 12px;
  }
  .fake-img p {
    font-family: monospace;
    color: white;
    text-align: left;
    margin: 12px 0;
    text-align: center;
    font-size: 16px;
  }
---

## WandB Tutorial

- WandB Platform
  - Experiments : experiment tracking
  - Sweeps : model optimization
  - Artifacts : dataset versioning
  - Tables : model evaluation
  - Reports : collaborative analysis

### Experiment

wandb.init(config=, tags=, name=) # run별로 구분하기 위해 tags=["batch=32", f"lr={wandb.config.lr}"] 또는 name=exp1 설정 # finished run resume하고 싶으면 id=...
wandb.watch(model=, criterion=, log='all')
wandb.log(<dict>, step=epoch)

모델 저장 
artifact = wandb.Artifact('model', type='model')
artifact.add_file(f"model/resnet50.pt")
wandb.log_artifact(artifact)

이미지 저장
images=[]
images.append(wandb.Image(img[0], caption="Pred: {} Truth: {}".format(pred[0].item(), target[0])))
wandb.log({"Image": images}) # 100여개 정도까지가 한계

wandb.finish()

### Sweep

sweep.yaml
program: main.py
method: bayes // grid 모든 조합 탐색, random 랜덤선택, bayes 좀 더 확인
name: ddpm-sweep
description: test ddpm sweep
project: ddpm
entity: semyu0102-viclab
meric:
  name: val_loss //wandb.log 안에 넣은 이름
  goal: minimize
parameters: # param. to sweep
  learning_rate: 
    min: 0.0001
    max: 0.1
  optimizer:
    values: ["adam", "sgd"] # 탐색 list
  epochs:
    value: 5 # 탐색x
  parameter1:
    distribution: normal
    mu: 100
    sigma: 10
early_terminate:
  type: hyperband # early stopping 알고리즘
  min_iter: 3
command:
  // python 파일 실행할 때 지정할 argument

wandb sweep sweep.yaml
wandb agent <위의 output> --count <sweep 횟수>